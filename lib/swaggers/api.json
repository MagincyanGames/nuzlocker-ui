{"openapi":"3.0.0","paths":{"/api/users":{"get":{"operationId":"UsersController_getUsers","parameters":[],"responses":{"200":{"description":"Lista completa de usuarios (sin contraseñas)","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/UserResponseDto"}}}}}},"summary":"Obtener todos los usuarios","tags":["Users"]}},"/api/users/search":{"get":{"operationId":"UsersController_search","parameters":[{"name":"query","required":true,"in":"query","description":"Texto a buscar en el username (mínimo 3 caracteres)","schema":{"type":"string"}}],"responses":{"200":{"description":"Usuarios encontrados que coinciden con la consulta (sin contraseñas)","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/UserResponseDto"}}}}},"400":{"description":"La consulta debe tener al menos 3 caracteres"}},"summary":"Buscar usuarios por username","tags":["Users"]}},"/api/users/{userId}/stats":{"get":{"operationId":"UsersController_getUserStats","parameters":[{"name":"userId","required":true,"in":"path","description":"ID del usuario","schema":{"type":"string"}}],"responses":{"200":{"description":"Estadísticas del usuario","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserStatsResponseDto"}}}},"404":{"description":"Usuario no encontrado"}},"summary":"Obtener estadísticas globales de un usuario","tags":["Users"]}},"/api/auth/login":{"post":{"operationId":"AuthController_login","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginDto"}}}},"responses":{"201":{"description":"Login exitoso","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponseDto"}}}},"401":{"description":"Credenciales incorrectas","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponseDto"}}}}},"summary":"Iniciar sesión de usuario","tags":["Autenticación"]}},"/api/auth/validate":{"post":{"operationId":"AuthController_validate","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ValidateTokenDto"}}}},"responses":{"200":{"description":"Token válido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ValidateTokenResponseDto"}}}},"401":{"description":"Token inválido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ValidateTokenResponseDto"}}}}},"summary":"Validar token JWT","tags":["Autenticación"]}},"/api/auth/register":{"post":{"operationId":"AuthController_register","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginDto"}}}},"responses":{"201":{"description":"Usuario registrado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterResponseDto"}}}},"400":{"description":"Error al registrar el usuario","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponseDto"}}}}},"summary":"Registrar nuevo usuario","tags":["Autenticación"]}},"/api/lockes":{"post":{"operationId":"LockesController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateLockeDto"}}}},"responses":{"201":{"description":"Locke creado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}},"400":{"description":"Datos inválidos"}},"security":[{"access-token":[]}],"summary":"Crear un nuevo locke","tags":["Lockes"]},"get":{"operationId":"LockesController_findAll","parameters":[{"name":"active","required":false,"in":"query","description":"Filtrar por estado activo. Si se omite, devuelve todos los lockes independientemente de su estado.","schema":{"enum":["true","false"],"type":"string"}}],"responses":{"200":{"description":"Lista de lockes","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}}}},"security":[{"access-token":[]}],"summary":"Obtener todos los lockes","tags":["Lockes"]}},"/api/lockes/{id}":{"get":{"operationId":"LockesController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Locke encontrado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}},"404":{"description":"Locke no encontrado"}},"security":[{"access-token":[]}],"summary":"Obtener un locke por ID","tags":["Lockes"]},"patch":{"operationId":"LockesController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateLockeDto"}}}},"responses":{"200":{"description":"Locke actualizado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}},"404":{"description":"Locke no encontrado"}},"security":[{"access-token":[]}],"summary":"Actualizar un locke","tags":["Lockes"]},"delete":{"operationId":"LockesController_remove","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Locke desactivado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}},"404":{"description":"Locke no encontrado"}},"security":[{"access-token":[]}],"summary":"Desactivar un locke","tags":["Lockes"]}},"/api/lockes/{id}/kills":{"post":{"operationId":"LockesController_addKill","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}},{"name":"userId","required":true,"in":"query","schema":{"type":"string"}},{"name":"count","required":true,"in":"query","schema":{"type":"number"}}],"responses":{"201":{"description":"Muerte registrada exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}},"400":{"description":"Datos inválidos"},"403":{"description":"No autorizado para registrar muertes de otro usuario"},"404":{"description":"Locke no encontrado"}},"security":[{"access-token":[]}],"summary":"Registrar una muerte en un locke","tags":["Lockes"]}},"/api/lockes/{id}/my-kills":{"post":{"operationId":"LockesController_addMyKill","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}},{"name":"count","required":true,"in":"query","schema":{"type":"number"}}],"responses":{"201":{"description":"Muerte registrada exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}},"400":{"description":"Datos inválidos"},"404":{"description":"Locke no encontrado"}},"security":[{"access-token":[]}],"summary":"Registrar una muerte propia en un locke","tags":["Lockes"]}},"/api/lockes/{id}/battles":{"post":{"operationId":"LockesController_addBattle","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateBattleDto"}}}},"responses":{"201":{"description":"Batalla registrada exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedBattleResponseDto"}}}},"400":{"description":"Datos inválidos"}},"security":[{"access-token":[]}],"summary":"Registrar o programar una batalla en un locke","tags":["Lockes"]},"get":{"operationId":"LockesController_getBattles","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Lista de batallas del locke","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/EnrichedBattleResponseDto"}}}}},"404":{"description":"Locke no encontrado"}},"security":[{"access-token":[]}],"summary":"Obtener todas las batallas de un locke","tags":["Lockes"]}},"/api/lockes/battles/{battleId}":{"patch":{"operationId":"LockesController_updateBattle","parameters":[{"name":"battleId","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateBattleDto"}}}},"responses":{"200":{"description":"Batalla actualizada exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedBattleResponseDto"}}}},"400":{"description":"Datos de actualización inválidos"},"403":{"description":"No autorizado para actualizar la batalla"},"404":{"description":"Batalla no encontrada"}},"security":[{"access-token":[]}],"summary":"Actualizar una batalla (estado, resultados, etc.)","tags":["Lockes"]}},"/api/lockes/{id}/leaderboard":{"get":{"operationId":"LockesController_getLeaderboard","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/ParticipantResponseDto"}}}}},"404":{"description":"Locke no encontrado"}},"security":[{"access-token":[]}],"summary":"Obtener clasificación de participantes en un locke","tags":["Lockes"]}},"/api/lockes/{id}/participants":{"post":{"operationId":"LockesController_addParticipant","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddParticipantDto"}}}},"responses":{"201":{"description":"Participante agregado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}},"400":{"description":"El participante ya existe en el locke"},"404":{"description":"Locke no encontrado"}},"security":[{"access-token":[]}],"summary":"Agregar un participante a un locke","tags":["Lockes"]}},"/api/lockes/user/{userId}":{"get":{"operationId":"LockesController_findByUser","parameters":[{"name":"userId","required":true,"in":"path","schema":{"type":"string"}},{"name":"includeParticipating","required":false,"in":"query","description":"Incluir lockes donde el usuario es solo participante. Por defecto es true.","schema":{"enum":["true","false"],"type":"string"}},{"name":"active","required":false,"in":"query","description":"Filtrar por estado activo. Si se omite, devuelve todos los lockes independientemente de su estado.","schema":{"enum":["true","false"],"type":"string"}}],"responses":{"200":{"description":"Lista de lockes del usuario","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}}}},"security":[{"access-token":[]}],"summary":"Obtener lockes de un usuario específico","tags":["Lockes"]}},"/api/lockes/my/lockes":{"get":{"operationId":"LockesController_findMyLockes","parameters":[{"name":"includeParticipating","required":false,"in":"query","description":"Incluir lockes donde el usuario es solo participante. Por defecto es true.","schema":{"enum":["true","false"],"type":"string"}},{"name":"active","required":false,"in":"query","description":"Filtrar por estado activo. Si se omite, devuelve todos los lockes independientemente de su estado.","schema":{"enum":["true","false"],"type":"string"}}],"responses":{"200":{"description":"Lista de lockes del usuario autenticado","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/EnrichedLockeResponseDto"}}}}}},"security":[{"access-token":[]}],"summary":"Obtener lockes del usuario autenticado","tags":["Lockes"]}}},"info":{"title":"Nuzlock Tracker API","description":"API for Nuzlock Tracker","version":"1.0","contact":{}},"tags":[{"name":"nuzlock-tracker","description":""}],"servers":[],"components":{"securitySchemes":{"access-token":{"scheme":"bearer","bearerFormat":"JWT","type":"http","name":"JWT","description":"Ingresa tu token JWT","in":"header"}},"schemas":{"UserResponseDto":{"type":"object","properties":{"_id":{"type":"string","description":"ID único del usuario"},"name":{"type":"string","description":"Nombre completo del usuario"},"username":{"type":"string","description":"Nombre de usuario (username)"}},"required":["_id","name","username"]},"UserStatsResponseDto":{"type":"object","properties":{"userId":{"type":"string","description":"ID del usuario"},"username":{"type":"string","description":"Nombre de usuario"},"name":{"type":"string","description":"Nombre completo del usuario"},"totalDeaths":{"type":"number","description":"Total de Pokémon muertos en todos los lockes"},"averageDeathsPerLocke":{"type":"number","description":"Media de Pokémon muertos por locke"},"totalLockes":{"type":"number","description":"Número de lockes en los que ha participado"}},"required":["userId","username","totalDeaths","averageDeathsPerLocke","totalLockes"]},"LoginDto":{"type":"object","properties":{"username":{"type":"string","description":"Username del usuario","example":"usuario1"},"password":{"type":"string","description":"Contraseña del usuario","example":"password123"}},"required":["username","password"]},"LoginResponseDto":{"type":"object","properties":{"id":{"type":"string","description":"ID del usuario"},"access_token":{"type":"string","description":"Token de acceso JWT"},"success":{"type":"boolean","description":"Indica si ha sido exitoso o no"}},"required":["id","access_token","success"]},"ErrorResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Indica si la operación fue exitosa","example":false},"message":{"type":"string","description":"Mensaje de error"}},"required":["success","message"]},"ValidateTokenDto":{"type":"object","properties":{"token":{"type":"string","description":"Token JWT de autenticación","example":"eyJhbG..."}},"required":["token"]},"ValidateTokenResponseDto":{"type":"object","properties":{"valid":{"type":"boolean","description":"Indica si el token es válido"},"id":{"type":"string","description":"ID del usuario"}},"required":["valid"]},"RegisterResponseDto":{"type":"object","properties":{"id":{"type":"string","description":"ID del usuario registrado"},"username":{"type":"string","description":"Nombre de usuario"},"name":{"type":"string","description":"Nombre completo"}},"required":["id","username"]},"CreateLockeDto":{"type":"object","properties":{"name":{"type":"string","description":"Nombre del locke"},"description":{"type":"string","description":"Descripción del locke"},"isActive":{"type":"boolean","description":"Indica si el locke está activo","default":true},"adminIds":{"description":"Lista inicial de IDs de administradores","type":"array","items":{"type":"string"}}},"required":["name"]},"EnrichedParticipantResponseDto":{"type":"object","properties":{"userId":{"type":"string","description":"ID del usuario participante"},"username":{"type":"string","description":"Nombre de usuario"},"name":{"type":"string","description":"Nombre completo"},"deaths":{"type":"number","description":"Número de muertes"},"points":{"type":"number","description":"Puntos acumulados"},"isAdmin":{"type":"boolean","description":"Indica si el participante es administrador"},"score":{"type":"number","description":"Puntuación total"}},"required":["userId","username","name","deaths","points","isAdmin","score"]},"EnrichedLockeResponseDto":{"type":"object","properties":{"_id":{"type":"string","description":"ID único del locke"},"name":{"type":"string","description":"Nombre del locke"},"participants":{"description":"Lista de participantes","type":"array","items":{"$ref":"#/components/schemas/EnrichedParticipantResponseDto"}},"adminIds":{"description":"Lista de IDs de administradores","type":"array","items":{"type":"string"}},"isActive":{"type":"boolean","description":"Indica si el locke está activo"},"createdAt":{"format":"date-time","type":"string","description":"Fecha de creación del locke"},"updatedAt":{"format":"date-time","type":"string","description":"Fecha de última actualización del locke"}},"required":["_id","name","participants","adminIds","isActive","createdAt","updatedAt"]},"UpdateLockeDto":{"type":"object","properties":{"name":{"type":"string","description":"Nombre del locke"},"description":{"type":"string","description":"Descripción del locke"},"isActive":{"type":"boolean","description":"Indica si el locke está activo","default":true},"adminIds":{"description":"Lista inicial de IDs de administradores","type":"array","items":{"type":"string"}}}},"ParticipantResultDto":{"type":"object","properties":{"userId":{"type":"string","description":"ID del usuario participante"},"score":{"type":"number","description":"Puntuación obtenida por el participante"}},"required":["userId","score"]},"CreateBattleDto":{"type":"object","properties":{"participantIds":{"description":"IDs de los usuarios participantes en la batalla","type":"array","items":{"type":"string"}},"status":{"type":"string","description":"Estado inicial de la batalla","enum":["scheduled","completed","canceled"],"default":"scheduled"},"results":{"description":"Resultados detallados (requerido si status es completed)","type":"array","items":{"$ref":"#/components/schemas/ParticipantResultDto"}},"bestOf":{"type":"number","description":"Sistema al mejor de X","default":3},"date":{"format":"date-time","type":"string","description":"Fecha de la batalla (null para fecha indeterminada)","nullable":true},"notes":{"type":"string","description":"Notas adicionales"}},"required":["participantIds","status","results","bestOf","notes"]},"EnrichedResultDto":{"type":"object","properties":{"userId":{"type":"string","description":"ID del usuario participante"},"score":{"type":"number","description":"Puntuación obtenida"},"username":{"type":"string","description":"Nombre de usuario"},"name":{"type":"string","description":"Nombre completo"}},"required":["userId","score","username","name"]},"EnrichedParticipantDto":{"type":"object","properties":{"userId":{"type":"string","description":"ID del usuario"},"username":{"type":"string","description":"Nombre de usuario"},"name":{"type":"string","description":"Nombre completo"}},"required":["userId","username","name"]},"EnrichedBattleResponseDto":{"type":"object","properties":{"_id":{"type":"string","description":"ID único de la batalla"},"participantIds":{"description":"IDs de los usuarios participantes en la batalla","type":"array","items":{"type":"string"}},"status":{"type":"string","description":"Estado de la batalla","enum":["scheduled","completed","canceled"]},"results":{"description":"Resultados con información de usuarios","type":"array","items":{"$ref":"#/components/schemas/EnrichedResultDto"}},"bestOf":{"type":"number","description":"Sistema al mejor de X","example":3},"lockeId":{"type":"string","description":"ID del locke al que pertenece la batalla"},"date":{"format":"date-time","type":"string","description":"Fecha de la batalla (null si está indeterminada)","nullable":true},"notes":{"type":"string","description":"Notas adicionales sobre la batalla"},"createdAt":{"format":"date-time","type":"string","description":"Fecha de creación del registro"},"participants":{"description":"Información detallada de los participantes","type":"array","items":{"$ref":"#/components/schemas/EnrichedParticipantDto"}}},"required":["_id","participantIds","status","results","bestOf","lockeId","createdAt"]},"UpdateBattleDto":{"type":"object","properties":{"status":{"type":"string","description":"Estado de la batalla","enum":["scheduled","completed","canceled"]},"results":{"description":"Resultados detallados de la batalla","type":"array","items":{"$ref":"#/components/schemas/ParticipantResultDto"}},"date":{"format":"date-time","type":"string","description":"Fecha de la batalla (null para fecha indeterminada)","nullable":true},"notes":{"type":"string","description":"Notas adicionales"}}},"ParticipantResponseDto":{"type":"object","properties":{"userId":{"type":"string","description":"ID del usuario participante"},"username":{"type":"string","description":"Nombre de usuario"},"name":{"type":"string","description":"Nombre completo"},"deaths":{"type":"number","description":"Número de muertes"},"points":{"type":"number","description":"Puntos acumulados"},"isAdmin":{"type":"boolean","description":"Indica si el participante es administrador"}},"required":["userId","username","name","deaths","points","isAdmin"]},"AddParticipantDto":{"type":"object","properties":{"userId":{"type":"string","description":"ID del usuario a agregar como participante"}},"required":["userId"]}}}}